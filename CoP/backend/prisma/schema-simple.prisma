generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Customer {
  id           String   @id @default(uuid())
  name         String
  industry     String?
  region       String?
  accountOwner String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  cops Cop[]
}

model Cop {
  id          String   @id @default(uuid())
  customerId  String
  name        String
  mission     String?
  vision      String?
  charterUrl  String?
  phase       CopPhase @default(FOUNDATION)
  isActive    Boolean  @default(true)
  startDate   DateTime?
  endDate     DateTime?
  createdById String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  customer Customer @relation(fields: [customerId], references: [id])
  memberships CopMembership[]
  events    Event[]
}

enum CopPhase {
  FOUNDATION
  LAUNCH
  GROWTH
  OPTIMIZATION
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  fullName  String?
  company   String?
  role      String?  // 'databricks_internal','customer_exec','customer_member'
  persona   String?  // 'AE','CSM','DE','DA','DS','Exec', etc
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  memberships CopMembership[]
  eventRegistrations EventRegistration[]
  eventAttendance EventAttendance[]
}

model CopMembership {
  id             String @id @default(uuid())
  copId          String
  userId         String
  membershipRole String   // 'member','champion','cop_lead','exec_sponsor'
  joinedAt       DateTime @default(now())

  cop  Cop  @relation(fields: [copId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@unique([copId, userId])
}

model Event {
  id          String   @id @default(uuid())
  copId       String
  title       String
  description String?
  eventType   String?  // 'training','office_hours','deep_dive','roadmap','community_meet'
  startsAt    DateTime
  endsAt      DateTime?
  location    String?
  createdById String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  cop Cop @relation(fields: [copId], references: [id])

  registrations EventRegistration[]
  attendance    EventAttendance[]
}

model EventRegistration {
  id          String   @id @default(uuid())
  eventId     String
  userId      String
  registeredAt DateTime @default(now())

  event Event @relation(fields: [eventId], references: [id])
  user  User  @relation(fields: [userId], references: [id])

  @@unique([eventId, userId])
}

model EventAttendance {
  id        String   @id @default(uuid())
  eventId   String
  userId    String
  attended  Boolean
  joinedAt  DateTime?
  leftAt    DateTime?

  event Event @relation(fields: [eventId], references: [id])
  user  User  @relation(fields: [userId], references: [id])

  @@unique([eventId, userId])
}


